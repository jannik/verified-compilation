\section{The \textnormal{\blang} Language}

\blang differs from \hlang in two important ways: variables are represented concretely by De Bruijn indices, and closures are managed explicitly instead of substituting arguments.


\subsection{Syntax}

We define variable indices $\bvar$ and \blang expressions $\bexp$ as follows:
\begin{align*}
	\bvar &\defi \z \alt \suc{i} \\
	\bexp &\defi \n{\nat} \alt \bvar \alt \blam{\bexp} \alt \bapp{\bexp_1}{\bexp_2} \alt \bsuc{\bexp}
\end{align*}
We will need a notion of \blang expressions being closed:



\begin{judgement}{\closed{k}{\bexp}}

\begin{prooftree}
  \ax{\closed{k}{\n{\nat}}}
\end{prooftree}

\begin{prooftree}
  \rightl{($\bvar < k$)}
  \ax{\closed{k}{\bvar}}
\end{prooftree}

\begin{prooftree}
  \ninf{\closed{k + 1}{\bexp_1}}
  \uinf{\closed{k}{\blam{\bexp_1}}}
\end{prooftree}

\begin{prooftree}
  \ninf{\closed{k}{\bexp_1}}
  \ninf{\closed{k}{\bexp_2}}
  \binf{\closed{k}{\bapp{\bexp_1}{\bexp_2}}}
\end{prooftree}

\begin{prooftree}
  \ninf{\closed{k}{\bexp_1}}
  \uinf{\closed{k}{\bsuc{\bexp_1}}}
\end{prooftree}

\end{judgement}

If \closed{0}{\bexp} we simply say that $\bexp$ is closed.

\subsection{Semantics}

The semantics of \blang is environment-based.
We define \blang values $\bval$ as follows, and environments $\benv$ are then ordered lists of values.
\begin{align*}
  \bval &\defi \n{\nat} \alt \cl{\benv}{\bexp} \\
  \benv &\defi \envnil \alt \benv \envcons \bval
\end{align*}
% maybe require that environments in closures are appropriately closed?

Before giving the main evaluation judgement, we introduce an auxiliary judgement for variable lookup.



\begin{judgement}{\blook{\benv}{\bvar}{\bval}}

\begin{prooftree}
  \leftl{\rulename{Bv-Here} :}
  \ax{\blook{\benv \envcons \bval}{\z}{\bval}}
\end{prooftree}

\begin{prooftree}
  \ninf{\blook{\benv}{\bvar}{\bval}}
  \leftl{\rulename{Bv-There} :}
  \uinf{\blook{\benv \envcons \bval'}{\suc{\bvar}}{\bval}}
\end{prooftree}

\end{judgement}

\begin{judgement}{\bev{\benv}{\bexp}{\bval}}

\begin{prooftree}
  \leftl{\rulename{B-Num} :}
  \ax{\bev{\benv}{\n{\nat}}{\n{\nat}}}
\end{prooftree}

\begin{prooftree}
  \ninf{\blook{\benv}{\bvar}{\bval}}
  \leftl{\rulename{B-Var} :}
  \uinf{\bev{\benv}{\bvar}{\bval}}
\end{prooftree}

\begin{prooftree}
  \leftl{\rulename{B-Lam :}}
  \ax{\bev{\benv}{\blam{\bexp_1}}{\cl{\benv}{\bexp_1}}}
\end{prooftree}

\begin{prooftree}
  \ninf{\bev{\benv}{\bexp_1}{\cl{\benv'}{\bexp_0}}}
  \ninf{\bev{\benv}{\bexp_2}{\bval_2}}
  \ninf{\bev{\benv' \envcons \bval_2}{\bexp_0}{\bval}}
	\leftl{\rulename{B-App} :}
  \tinf{\bev{\benv}{\bapp{\bexp_1}{\bexp_2}}{\bval}}
\end{prooftree}

\begin{prooftree}
  \ninf{\bev{\benv}{\bexp_1}{\n{\nat}}}
	\leftl{\rulename{B-Suc} :}
  \uinf{\bev{\benv}{\bsuc{\bexp_1}}{\n{\nat + 1}}}
\end{prooftree}

\end{judgement}
