\subsection*{Equivalence}

\begin{theorem} [Equivalence Bruijn-Stack]
\label{thm:equiv-bs} If \trabsfinal{\bexp}{\sprog}, then \bev{\envnil}{\bexp}{\n{\nat}} if and only if \sev{\sprog}{\n{\nat}}.
\end{theorem}

To prove this we need two additional judgements:

\vspace{0.5cm}

\judgement{\cor{\bval}{\sval}}

\begin{prooftree}
  \leftl{\rule{C-Num} :}
  \ax{\cor{\n{\nat}}{\n{\nat}}}
\end{prooftree}

\begin{prooftree}
  \ninf{\cor{\benv}{\senv}}
  \ninf{\trabsfinal{\bexp}{\sprog}}
  \leftl{\rule{C-Fun} :}
  \binf{\cor{\cl{\benv}{\bexp}}{\cl{\senv}{\sprog}}}
\end{prooftree}

\judgement{\cor{\benv}{\senv}}

\begin{prooftree}
  \leftl{\rule{D-Nil} :}
  \ax{\cor{\envnil}{\envnil}}
\end{prooftree}

\begin{prooftree}
  \ninf{\cor{\benv}{\senv}}
  \ninf{\cor{\bval}{\sval}}
  \leftl{\rule{D-Cons} :}
  \binf{\cor{\benv \envcons \bval}{\senv \envcons \sval}}
\end{prooftree}

\begin{lemma}[Completeness]
\label{lem:completeness-bs}
If \trabs{\bexp}{\sprog_2}{\sprog} and \bev{\benv}{\bexp}{\bval} with \cor{\benv}{\senv}, then (for all $\sctrl$ and $\svals$) there exists $\sval$ such that \ssteps{\sctrl \stkcons \fr{\senv}{\sprog}}{\svals}{\sctrl \stkcons \fr{\senv}{\sprog_2}}{\svals \stkcons \sval} with \cor{\bval}{\sval}.
\end{lemma}

Let $\prec$ denote the standard subtree order on step sequences, i.e. $\P_1 \prec \P_2$ if $\P_1$ is a proper suffix of $\P_2$.

\begin{lemma}[Soundness]
\label{lem:soundness-bs}
If \trabs{\bexp}{\sprog_2}{\sprog} and \ssteps{\sctrl \stkcons \fr{\senv}{\sprog}}{\svals}{\stknil}{[\sval']} (by $\P$) with \cor{\benv}{\senv}, then there exists $\bval$ and $\sval$ such that \bev{\benv}{\bexp}{\bval} with \cor{\bval}{\sval} and \ssteps{\sctrl \stkcons \fr{\senv}{\sprog_2}}{\svals \stkcons \sval}{\stknil}{[\sval']} (by $\P'$) where $\P' \prec \P$.
\end{lemma}
